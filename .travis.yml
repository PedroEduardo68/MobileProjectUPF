language: node_js
node_js:
- '8'
sudo: false
cache:
  directories:
  - "$HOME/.yarn-cache"
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
notifications:
  email:
    recipients:
    - nicolau.3g@gmail.com
    on_success: always
    on_failure: always
env:
  matrix:
  - NODE_ENV='test'
script:
- cp env.example.js env.js
- npm run lint
- npm test
- npm run bundle:ios
- npm run bundle:android
matrix:
  include:
  - language: android
    os: linux
    jdk: oraclejdk8
    env:
    - ANDROID_API=23
    - ANDROID_BUILD_TOOLS=27.0.1
    before_cache:
    - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
    - rm -fr $HOME/.gradle/caches/*/plugin-resolution/
    cache:
      directories: "-$HOME/.gradle/caches/ -$HOME/.gradle/wrapper/"
    sudo: required
    node_js: false
    before_install:
    - nvm install 8
    - node --version
    - travis_retry curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key
      add -
    - echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
    - travis_retry sudo apt-get update -qq
    - travis_retry sudo apt-get install -y -qq yarn
    - chmod +x android/gradlew
    install:
    - yarn
    android:
      components:
      - tools
      - platform-tools
      - build-tools-$ANDROID_BUILD_TOOLS
      - android-23
      - extra-android-m2repository
      - extra-google-google_play_services
      - extra-google-m2repository
      - addon-google_apis-google-19
    script:
    - cd android && ./gradlew assembleDebug && ./gradlew assembleRelease
    deploy:
      user: marcionicolau
      password: qikXodm905BZ0aXx42ZHVLdcz3ii4n1Rp+ywodZDwv/rR8nQflo22l0nfD8HuaIQCNP/GzwAFp7Hl+vytcrdCRPkRt08HtQSz+z1XZTk2A3maeu5y5uCyzUKmC7uyDtM4eLumyZq8gi4WwWNDKmUf6rs8xpot1y+m6OhKser0HlT3sYUmE1AYO3/jJ+ilgSkFjmATlo9xp1m2Mpxh95odr3r0k826MH6k8RFXtgOnzqYLopxR5ofvd//BoeSAkSKF/CueMbe6B/vO2sljZj91He8YMe1LtSmt0mrMHY2pPIkJQnNGoZXGgDv/+7YWobymwJNdF2RioAPjdHKY1FmElsfnrO4ts6CjY1zO9OafR2XvmCqkb9dR+RNoDi3PwN3WBPLXH/a9HDhLFdb1mtt6xP+5TE9lb5kkD3PAcfFFHCcGqRiCJynfuAFAEfPcxO3bPAKVfMXSljSHdduOwTY4ye7AKgcvHYHEVzvgStFkNNzqBE7M4e+lSNzHuv+2a4x5kTkHxl4mujaTTT5UlAd7Nvi+HPABxGiyIWBuH0iREQIbBAeXARDiRTLIccUWXbTQiCGZeo0If8zN03drFLm5n6oxkEyK6DKvuMcbCrL2PrjeosSur9eqSyxdvKy+aK5Y24/9cizaXuMWN8p4JKKoFUC7pmMdxHyi3kvhKVFdYI=
      provider: releases
      file: android/app/build/outputs/apk/app-release-unsigned.apk
      skip_cleanup: true
    on:
      repo: marcionicolau/MobileProjectUPF
      tags: true
      jdk: oraclejdk8
  - language: objective-c
    os: osx
    osx_image: xcode8.3
    node_js: false
    before_install:
    - nvm install 8
    - node --version
    - travis_retry npm install -g yarn
    - yarn -version
    install:
    - travis_retry gem install xcpretty
    - travis_retry yarn
    xcode_project: ios/MobileProjectUPF.xcodeproj
    xcode_scheme: ios/MobileProjectUPFTests
    script:
    - cd ios
    - xcodebuild -scheme MobileProjectUPF -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
      | xcpretty
    - travis_retry xctool run-tests -scheme MobileProjectUPF -sdk iphonesimulator
      -launch-timeout 90  ONLY_ACTIVE_ARCH=NO

